<?php
 function _block_bindings_post_meta_get_value( array $source_args, $block_instance ) { if ( empty( $source_args['key'] ) ) { return null; } if ( empty( $block_instance->context['postId'] ) ) { return null; } $post_id = $block_instance->context['postId']; $post = get_post( $post_id ); if ( ( ! is_post_publicly_viewable( $post ) && ! current_user_can( 'read_post', $post_id ) ) || post_password_required( $post ) ) { return null; } if ( is_protected_meta( $source_args['key'], 'post' ) ) { return null; } $meta_keys = get_registered_meta_keys( 'post', $block_instance->context['postType'] ); $meta_keys = array_merge( $meta_keys, get_registered_meta_keys( 'post', '' ) ); if ( empty( $meta_keys[ $source_args['key'] ]['show_in_rest'] ) ) { return null; } return get_post_meta( $post_id, $source_args['key'], true ); } function _register_block_bindings_post_meta_source() { register_block_bindings_source( 'core/post-meta', array( 'label' => _x( 'Post Meta', 'block bindings source' ), 'get_value_callback' => '_block_bindings_post_meta_get_value', 'uses_context' => array( 'postId', 'postType' ), ) ); } add_action( 'init', '_register_block_bindings_post_meta_source' ); 